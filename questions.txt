COPY  START  100
FIRST STL RETADR
CLOOP JSUB RDREC
LDA LENGTH
test_label COMP ZERO
JEQ ENDFIL
JSUB WRREC
J CLOOP
ENDFIL LDA EOF
STA BUFF
LDA THREE


STA LENGTH
JSUB WRREC
LDL RETADR
J  test_label
RSUB
EOF BYTE C'EOFAc  b'
THREE WORD 4096
ZERO WORD -4096
RETADR RESW 1
LENGTH RESW 3
BUFF RESB 1096
.
. SUBROUTINE TO READ RECORD INTO BUFFER
.
RDREC LDX ZERO
.LDA ZERO
RLOOP TD INPUT
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
EXIT STX LENGTH
RSUB
INPUT BYTE X'F1'
MAXLEN WORD 4096
.
. SUBROUTINE TO WRITE RECORD FROM BUFFER
.
WRREC LDX ZERO
WLOOP TD OUTPUT
JEQ WLOOP
LDCH BUFF , X
WD OUTPUT
TIX LENGTH
JLT WLOOP
RSUB
OUTPUT BYTE X'05'
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
JEQ 
RLOOP
RD 




INPUT
COMP ZERO

JEQ EXIT
STCH BUFF,X
TIX MAXLEN





JLT RLOOP
JEQ RLOOP
RD INPUT
COMP ZERO
JEQ EXIT
STCH BUFF,X
TIX MAXLEN
JLT RLOOP
END